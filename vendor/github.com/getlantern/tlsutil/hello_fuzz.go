// +build gofuzz

package tlsutil

import (
	base "github.com/dvyukov/go-fuzz/go-fuzz-defs"
)

// go-fuzz-build creates a temporary program and wants to import stuff from go-fuzz to compile. This
// requires a manual 'go get github.com/dvyukov/go-fuzz', which 'go mod tidy' will later want to
// clean up. This constant allows us to always import go-fuzz without upsetting 'go mod tidy'.
const _ = base.CoverSize

/*
	This is a wrapper function for https://github.com/dvyukov/go-fuzz to fuzz this package
	---
	To run it, check the README.md of that project since it may have changed
*/

func Fuzz(data []byte) int {
	/*
		Data is a random input generated by go-fuzz, note that in most cases it is
		invalid. The function must return 1 if the fuzzer should increase priority of
		the given input during subsequent fuzzing (for example, the input is lexically
		correct and was parsed successfully); -1 if the input must not be added to
		corpus even if gives new coverage; and 0 otherwise; other values are reserved
		for future use.
	*/
	_, err := ValidateClientHello(data)
	if err != nil {
		return 0
	}
	return 1
}
